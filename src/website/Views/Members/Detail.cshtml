@model MemberSummary
@{
  ViewBag.Title = Model.Name;
  ViewBag.NgController = "MembersDetailCtrl";
  ViewBag.NgInit = Html.Raw("init('" + Model.Id + "')");
}
@using Kcsara.Database.Web.Models;
<div class="row">
  <div class="col-lg-5 col-sm-6 col-xs-12">
    <div class="box box-primary">
      <div class="box-body">
        <img class="member-photo" src="~/photos/@Model.Photo" />
        <h3>@Model.Name</h3>
      </div>
    </div>
  </div>
</div>
<md-tabs md-dynamic-height md-border-bottom class="md-whiteframe-4dp">
  <md-tab label="Basics" md-active="activeTab == 'info'" md-on-select="setTab('info')">
    <md-content class="md-padding" ng-controller="MemberInfoCtrl" ng-init="init('@Model.Id', @(ViewBag.IsSelf ? "true" : "false"))" ng-if="activeTab == 'info'">
      <div class="col-xs-12 col-sm-8 col-md-6 col-lg-3">
        <div class="box box-primary shadow-1">
          <div class="box-header with-border">
            <h3 class="box-title">Unit Membership</h3>
            <div class="box-tools pull-right">
              <button type="button" class="btn btn-box-tool btn-box-primary" title="Add Membership Change" ng-click="startAddMembership()">
                <i class="fa fa-2x fa-plus-circle"></i>
              </button>
            </div>
          </div>
          <div class="box-body">
            <table class="table table-striped table-responsive">
              <thead><tr><th>Unit</th><th>Status</th><th>Since</th></tr></thead>
              <tbody>
                <tr ng-repeat="m in memberships"><td>{{m.unit.name}}</td><td>{{m.status}}</td><td>{{m.start.format('YYYY-MM-DD')}}</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-10 col-md-8 col-lg-3">
        <div class="box box-primary collapsed-box shadow-1">
          <div class="box-header with-border">
            <h3 class="box-title">Medical Info</h3>
            <div class="box-tools pull-right">
              <button type="button" class="btn btn-box-tool" data-widget="collapse" title="View/Hide Medical Information" ng-click="toggleMedical($event)">
                <i ng-class="{'fa-chevron-down': !viewMedical, 'fa-chevron-up': viewMedical}" class="fa"></i>
              </button>
            </div>
          </div>
          <div class="box-body" style="display:none;">
            <div ng-if="medical.loading"><i class="fa fa-refresh fa-spin"></i> Loading ...</div>
            <div ng-if="!medical.loading">
              <label>Allergies:</label>
              <p>{{medical.allergies || 'none'}}</p>
              <label>Medications:</label>
              <p>{{medical.medication || 'none'}}</p>
              <label>Medical/Physical Conditions:</label>
              <p>{{medical.conditions || 'none'}}</p>
              <label>Emergency Contacts:</label>
              <table class="table table-striped table-responsive">
                <thead><tr><th>Name</th><th>Relationship</th><th>Type</th><th>Number</th></tr></thead>
                <tbody>
                  <tr><td ng-if="!medical.contacts.length" colspan="4">No contacts listed</td></tr>
                  <tr ng-repeat="m in medical.contacts"><td>{{m.name}}</td><td>{{m.relationship}}</td><td>{{m.type}}</td><td>{{m.number}}</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </md-content>
  </md-tab>
  <md-tab label="Contact" md-active="activeTab == 'contact'" md-on-select="setTab('contact')">
    <md-content class="md-padding" ng-controller="MemberContactsCtrl" ng-init="init('@Model.Id')" ng-if="activeTab == 'contact'">
      <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
        <div class="box box-primary shadow-1">
          <div class="box-header with-border">
            <h3 class="box-title">Contact Info</h3>
            <div class="box-tools pull-right">
              <button type="button" class="btn btn-box-tool btn-box-primary" ng-click="startAddContact()">
                <i class="fa fa-2x fa-plus-circle"></i>
              </button>
            </div>
          </div>
          <div class="box-body">
            <table id="contacts_table" class="table table-bordered table-condensed table-striped table-responsive">
              <thead style="display:none;"><tr><th>Type</th><th>SubType</th><th>Value</th></tr></thead>
              <tbody>
                <tr ng-repeat="c in contacts">
                  <td class="hidden-xs">{{c.type}}</td>
                  <td>{{c.subType}}</td>
                  <td ng-switch="c.type">
                    <a ng-switch-when="email" ng-href="{{'mailto:' + c.value}}">{{c.value}}</a>
                    <a ng-switch-when="phone" ng-href="{{'tel:' + c.value}}">{{c.value}}</a>
                    <span ng-switch-default>{{c.value}}</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
        <div class="box box-primary shadow-1">
          <div class="box-header with-border">
            <h3 class="box-title">Address</h3>
            <div class="box-tools pull-right">
              <button type="button" class="btn btn-box-tool btn-box-primary" ng-click="startAddAddress()">
                <i class="fa fa-2x fa-plus-circle"></i>
              </button>
            </div>
          </div>
          <div class="box-body">
            <div class="info-box" style="min-height:50px" ng-repeat="a in addresses">
              <span class="info-box-icon" style="width:50px; height:50px; line-height:50px;font-size:22px; background-color:white;"><i ng-class="{'fa-envelope-o': a.type == 'mailing', 'fa-home': a.type == 'residence'}" class="fa"></i></span>
              <div class="info-box-content" style="margin-left:50px">
                <address>
                  <a ng-if="a.type != 'mailing'" ng-href="{{'http://maps.google.com/?daddr=' + a.street + '+' + a.city + ',+' + a.state + '+' + a.zip}}" href="#" target="_blank">
                    {{a.street}}<br />
                    {{a.city}}, {{a.state}} {{a.zip}}<br />
                  </a>
                  <div ng-if="a.type == 'mailing'">
                    {{a.street}}<br />
                    {{a.city}}, {{a.state}} {{a.zip}}<br />
                  </div>
                </address>
              </div>
              <!-- /.info-box-content -->
            </div>
          </div>
        </div>
      </div>
    </md-content>
  </md-tab>
  <md-tab label="Training" md-active="activeTab == 'training'" md-on-select="setTab('training')">
    <md-content class="md-padding" ng-if="activeTab == 'training'" ng-controller="MemberTrainingCtrl" ng-init="init('@Model.Id');">
      <div class="col-xs-12 col-lg-7">
        <div class="box box-primary shadow-1">
          <div class="box-header with-border">
            <h3 class="box-title">Completed Training</h3>
          </div>
          <div class="box-body">
            <table class="table table-bordered table-condensed table-striped table-responsive">
              <thead><tr><th>Course</th><th>Via</th><th>Completed</th><th>Expires</th></tr></thead>
              <tbody>
                <tr ng-repeat="l in latest | limitTo:(moreTraining?undefined:10)">
                  <td>{{l.course.name}}</td>
                  <td>tbd</td>
                  <td>{{l.completed.format('YYYY-MM-DD')}}</td>
                  <td>{{l.expires ? l.expires.format('YYYY-MM-DD') : null}}</td>
                </tr>
              </tbody>
            </table>
            <button class="btn btn-link" ng-if="!moreTraining" ng-click="showMoreTraining()">Show more</button>
            <div ng-if="latest.loading" class="overlay">
              <i class="fa fa-refresh fa-spin"></i>
            </div>
          </div>
          @*<div class="box-footer box-action-footer">
            <div class="col-xs-12"><a href="~/Members/@Model.Id/training/list">Show All</a></div>
          </div>*@
        </div>
      </div>

      <div class="col-xs-12">
        <div class="box box-primary shadow-1" ng-controller="MemberEventsCtrl" ng-init="init('@Model.Id', 'training', false, 'Training');">
          <div class="box-header with-border">
            <h3 class="box-title">Training Rosters</h3>
          </div>
          <div class="box-body" ng-include="window.appRoot + '/partials/members/event-table.html'">
          </div>
        </div>
      </div>
    </md-content>
  </md-tab>
  <md-tab label="Missions" md-active="activeTab == 'missions'" md-on-select="setTab('missions')">
    <md-content class="md-padding"
                ng-controller="MemberEventsCtrl"
                ng-init="init('@Model.Id', 'missions', true, 'Mission');"
                ng-include="window.appRoot + '/partials/members/event-table.html'"
                ng-if="activeTab == 'missions'">
    </md-content>
  </md-tab>
</md-tabs>